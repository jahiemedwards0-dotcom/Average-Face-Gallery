<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Human Morph Gallery</title>
  <style>
    :root{--bg:#0b0d10;--fg:#e9eef5;--muted:#9fb0c3;--card:#14181f;--accent:#7aa2ff;--chip:#1d2430;--ring:#2a3342}
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;
      font:16px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
      color:var(--fg);
      background:
        radial-gradient(1200px 800px at 80% -10%,#162032 0%,transparent 60%),
        var(--bg);
    }
    header{
      position:sticky;
      top:0;
      background:rgba(11,13,16,.6);
      backdrop-filter:saturate(140%) blur(8px);
      border-bottom:1px solid var(--ring);
      z-index:5;
    }
    .wrap{max-width:1150px;margin:0 auto;padding:16px}
    h1{font-size:22px;margin:0}
    nav{display:flex;gap:10px;margin-top:8px;flex-wrap:wrap}
    .tab{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--ring);
      background:var(--chip);
      color:var(--muted);
      text-decoration:none;
    }
    .tab.active{
      color:#081329;
      background:var(--accent);
      border-color:transparent;
      font-weight:700;
    }

    .controls{
      display:grid;
      grid-template-columns:1fr 1fr 1fr auto;
      gap:10px;
      margin-top:12px
    }
    input,select,button{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--ring);
      background:var(--card);
      color:var(--fg);
    }
    .btn{
      background:var(--accent);
      color:#081329;
      border:none;
      font-weight:700;
      cursor:pointer;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
      gap:14px;
      padding:18px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--ring);
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 4px 14px rgba(0,0,0,.25);
      transition:transform .15s ease;
    }
    .card:hover{transform:translateY(-2px)}
    .thumbWrap{
      position:relative;
      aspect-ratio:2/3;
      background:var(--chip);
      display:flex;
      align-items:stretch;
      justify-content:center;
      overflow:hidden;
    }
    .thumbWrap::before{
      content:'';
      display:block;
      padding-top:150%;
      width:100%;
      pointer-events:none;
    }
    .thumb{
      position:absolute;
      inset:0;
      margin:auto;
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }
    .meta{padding:12px}
    .title{font-weight:600}
    .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .chip{
      background:var(--chip);
      border:1px solid var(--ring);
      color:var(--muted);
      padding:4px 8px;
      border-radius:999px;
      font-size:12px;
    }
    .empty{opacity:.7;text-align:center;padding:50px}
    .footer{opacity:.7;text-align:center;padding:28px}
    .muted{opacity:.75}

    /* Lists */
    .list{padding:18px}
    .list h2{font-size:18px;margin:16px 0 8px}
    .az{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
      gap:10px;
    }
    .az a{
      display:block;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--ring);
      background:var(--card);
      text-decoration:none;
      color:var(--fg);
    }
    .kvs{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
      gap:10px;
    }

    /* Modal */
    dialog{
      border:none;
      border-radius:18px;
      max-width:min(980px,92vw);
      padding:0;
      background:var(--card);
      color:var(--fg);
      box-shadow:0 20px 70px rgba(0,0,0,.5);
    }
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .modalHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border-bottom:1px solid var(--ring);
    }
    .modalBody{
      display:grid;
      grid-template-columns:minmax(260px,44%) 1fr;
      gap:16px;
      padding:16px;
    }
    .modalBody img{
      width:100%;
      height:auto;
      border-radius:14px;
      border:1px solid var(--ring);
    }
    .pill{
      font-size:12px;
      background:var(--chip);
      border:1px solid var(--ring);
      padding:3px 8px;
      border-radius:999px;
      margin-right:6px;
      color:var(--muted);
    }
    .badges{display:flex;flex-wrap:wrap;gap:6px}
    .close{
      background:transparent;
      border:1px solid var(--ring);
      color:var(--fg);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
    }

    @media (max-width:900px){
      .controls{
        grid-template-columns:1fr 1fr;
        grid-auto-rows:auto;
      }
      .modalBody{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Human Morph Gallery (Developing)</h1>
      <nav>
        <a class="tab" data-tab="gallery" href="#/gallery">Gallery</a>
        <a class="tab" data-tab="az" href="#/a-z">A–Z</a>
        <a class="tab" data-tab="regions" href="#/regions">Regions</a>
        <a class="tab" data-tab="about" href="#/about">About</a>
      </nav>
      <div class="controls">
        <input id="q" placeholder="Search name, country, notes…" />
        <select id="region">
          <option value="">All regions</option>
        </select>
        <!-- fixed categories: Average face + Phenotype -->
        <select id="category">
          <option value="">All types</option>
          <option value="Average face">Average face</option>
          <option value="Phenotype">Phenotype</option>
        </select>
        <button id="contributeBtn" class="btn" type="button">
          Submit a request
        </button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Gallery is ALWAYS visible at the top -->
    <section id="view-gallery" class="grid" aria-live="polite"></section>

    <!-- These sections appear BELOW the gallery depending on the tab -->
    <section id="view-az" class="list" hidden></section>
    <section id="view-regions" class="list" hidden></section>

    <section id="view-about" class="list" hidden>
      <h2>About & Methods</h2>
      <p>
        This is a static, free-to-host gallery for average faces and morphs.
        Images live in <code>/images/</code>; entries are stored directly in the
        page for now.
      </p>
      <h3>Disclaimer</h3>
      <p>
        Faces here are averaged from real people, then lightly enhanced for clarity
        and hyperrealism. They illustrate trends in the source sets but are neither
        definitive nor absolute; as more material is gathered or methods improve,
        each entry may change. Please read notes and sources on each item (if available).
      </p>
    </section>

    <section id="contribute" class="list">
      <h2>Submit a request</h2>
      <p>
        Fill out the form below to request a new phenotype or average face, or to
        share information that can help refine existing entries.
      </p>
      <!-- Embedded Tally form -->
      <iframe
        src="https://tally.so/r/mDrLBj?transparentBackground=1&hideTitle=1"
        width="100%"
        height="500"
        frameborder="0"
        marginheight="0"
        marginwidth="0"
        title="Phenotype & average face request form">
      </iframe>
      <p class="muted" style="margin-top:8px">
        If the form does not load, you can open it directly
        <a href="https://tally.so/r/mDrLBj" target="_blank" rel="noopener">here</a>.
      </p>
    </section>

    <div id="empty" class="empty" hidden>
      Nothing found. Adjust filters or add more morphs.
    </div>
    <div class="footer">
      © <span id="year"></span> Your Site.
    </div>
  </main>

  <dialog id="modal">
    <div class="modalHead">
      <div>
        <strong id="mTitle"></strong>
        <div class="badges" id="mBadges"></div>
      </div>
      <div>
        <button class="close" type="button" onclick="modal.close()">Close</button>
      </div>
    </div>
    <div class="modalBody">
      <img id="mImg" alt="Morph preview" />
      <div>
        <p id="mNotes" style="margin-top:0"></p>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div>
            <div class="pill">Source(s)</div>
            <ul id="mSources" style="margin-top:8px"></ul>
          </div>
          <div>
            <div class="pill">Tags</div>
            <div id="mTags" class="chips" style="margin-top:8px"></div>
          </div>
        </div>
        <div style="margin-top:14px">
          <a id="mFile" download>Download image</a>
        </div>
      </div>
    </div>
  </dialog>

  <script>
  // ---------- Starter data: Sinaloid + averages --------------------------
  // Make sure these images exist in /images/:
  // sinaloid.jpg, sinaloid-map.jpg, mississipid.jpg, mississipid-map.jpg,
  // avg_afghan_pashtun.jpg, avg_salvadorann.jpg, avg_english.jpg,
  // avg_irish.jpg, avg_bengali.jpg

  let DATA = [
    {
      id: "sinaloid",
      title: "Sinaloid",
      macro: "Latin America",
      country: "Mexico",
      region: "Northwest & North-Central Mexico",
      category: "Phenotype",
      img: "images/sinaloid.jpg",
      tags: [
        "Sinaloid",
        "Mexico & Central America mestizo",
        "NW Mexico",
        "ranching",
        "mining",
        "regional variant"
      ],
      sources: [ {label:"User composite & notes", url: ""} ],
      notes: `
        <h3>Description</h3>
        <p>
          A regional variant within the broader Mexico and Central America–Mestizo
          complex. It formed in the ranching–mining belt of northwest and
          north-central Mexico through long-term Spanish–Indigenous admixture.
        </p>

        <h3>Traits</h3>
        <ul>
          <li>Skin light- to medium-brown, tanning deeply; stature average to tall with a compact, stockier build.</li>
          <li>Faces often rounder in men and slightly longer in women; mild neoteny (soft, baby-faced look) is common.</li>
          <li>Nose medium and usually projecting; lips full.</li>
          <li>Eyes predominantly dark and slightly upturned; lighter shades appear in a minority; occasional epicanthic folds.</li>
          <li>Hair dark brown to black; straight or wavy; curls not rare.</li>
        </ul>

        <img src="images/sinaloid-map.jpg"
             alt="Sinaloid map"
             style="display:block;width:100%;margin-top:10px;border-radius:12px;">
      `
    },
    {
      id: "avg_afghan_pashtun",
      title: "Average Afghan Pashtun",
      macro: "South Asia",
      country: "Afghanistan / Pakistan",
      region: "Pashtun belt",
      category: "Average face",
      img: "images/avg_afghan_pashtun.jpg",
      tags: ["Afghan","Pashtun","Average face"],
      sources: [ {label:"Average Afghan Pashtun morph", url: ""} ],
      notes: "National / regional facial average morph. Add detailed traits and description later."
    },
    {
      id: "mississipid",
      title: "Mississipid",
      macro: "North America",
      country: "United States",
      region: "Deep South & Great Migration corridors",
      category: "Phenotype",
      img: "images/mississipid.jpg",
      tags: [
        "Mississipid",
        "African American",
        "Deep South",
        "Great Migration",
        "Phenotype"
      ],
      sources: [ { label: "User composite & notes", url: "" } ],
      notes: `
        <h3>Description</h3>
        <p>
          Historically, this African American phenotype developed in the plantation
          South of the United States. From the Deep South, it spread into the Great
          Lakes region, the East Coast corridor, and the West Coast during the
          Great Migration. It is the most common phenotypic pattern among African Americans.
          It is especially common among Urban African Americans, Gullah Geechee communities,
          church-based networks, and multi-generation Southern families.
        </p>

        <h3>Traits</h3>
        <ul>
          <li>Medium-to-dark brown skin with warm or reddish undertones.</li>
          <li>Face usually round or oval; nose typically medium-broad.</li>
          <li>Lips full; jawline tapered rather than boxy.</li>
          <li>Eyes predominantly dark brown, with hazel appearing randomly in some individuals; medium-set with slightly hooded lids and, on rare occasions, faint epicanthic folds.</li>
          <li>Hair texture most often ranges from tight coils to looser curls (approximately 4C to 3C).</li>
        </ul>

        <img src="images/mississipid-map.jpg"
             alt="Mississipid distribution map"
             style="display:block;width:100%;margin-top:10px;border-radius:12px;">
      `
    },
    {
      id: "avg_salvadoran",
      title: "Average Salvadoran",
      macro: "Latin America",
      country: "El Salvador",
      region: "El Salvador",
      category: "Average face",
      img: "images/avg_salvadorann.jpg",
      tags: ["El Salvador","Mestizo","Average face"],
      sources: [ {label:"Average Salvadoran morph", url: ""} ],
      notes: "National facial average morph. Add phenotype write-up and traits later."
    },
    {
      id: "avg_english",
      title: "Average English",
      macro: "Europe",
      country: "United Kingdom",
      region: "England",
      category: "Average face",
      img: "images/avg_english.jpg",
      tags: ["English","UK","Average face"],
      sources: [ {label:"Average English morph", url: ""} ],
      notes: "National facial average morph. Add phenotype notes later."
    },
    {
      id: "avg_irish",
      title: "Average Irish",
      macro: "Europe",
      country: "Ireland",
      region: "Ireland",
      category: "Average face",
      img: "images/avg_irish.jpg",
      tags: ["Irish","Ireland","Average face"],
      sources: [ {label:"Average Irish morph", url: ""} ],
      notes: "National facial average morph. Add phenotype notes later."
    },
    {
      id: "avg_bengali_bd",
      title: "Average Bengali (Bangladesh)",
      macro: "South Asia",
      country: "Bangladesh",
      region: "Bangladesh",
      category: "Average face",
      img: "images/avg_bengali.jpg",
      tags: ["Bangladesh","Bengali","Average face"],
      sources: [ {label:"Average Bengali morph (Bangladesh)", url: ""} ],
      notes: `
        Bengalis of Bangladesh often have broad, round faces, though more angular
        shapes are also common. The nose is usually straight and narrow, and sometimes
        has a gently convex or convex bridge. Skin tones range from light brown to
        deep medium brown, and hair is generally straight to very wavy and dark in
        color. Lips tend to be medium to full. The eyes are usually dark brown;
        lighter shades are uncommon, and some individuals may have a faint inner eye
        fold, high cheekbones, or features that lean toward an East Eurasian
        appearance.
      `
    }
  ]
  // -------------------------------------------------------------------------
  const $ = s=>document.querySelector(s)
  const grid = $('#view-gallery'),
        q = $('#q'),
        regionSel = $('#region'),
        catSel = $('#category')
  const modal = $('#modal')
  const mTitle = $('#mTitle'),
        mImg = $('#mImg'),
        mNotes = $('#mNotes'),
        mSources = $('#mSources'),
        mTags = $('#mTags'),
        mBadges = $('#mBadges'),
        mFile = $('#mFile')
  const viewAZ = $('#view-az'),
        viewRegions = $('#view-regions'),
        viewAbout = $('#view-about'),
        contributeSection = $('#contribute')
  document.getElementById('year').textContent = new Date().getFullYear()

  const hashForTab = {
    gallery: '#/gallery',
    az: '#/a-z',
    regions: '#/regions',
    about: '#/about'
  }
  let lastViewHash = '#/gallery'

  // Tabs -------------------------------------------------------------
  const tabs = [...document.querySelectorAll('.tab')]
  function setTab(name){
    tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab===name))

    // Gallery always visible; we only show ONE extra section under it
    viewAZ.hidden      = name !== 'az'
    viewRegions.hidden = name !== 'regions'
    viewAbout.hidden   = name !== 'about'

    if (hashForTab[name]) lastViewHash = hashForTab[name]

    // Scroll to the chosen section (except gallery)
    let target = null
    if(name === 'az') target = viewAZ
    else if(name === 'regions') target = viewRegions
    else if(name === 'about') target = viewAbout
    if(target){
      target.scrollIntoView({behavior:'smooth'})
    } else {
      // Gallery tab: scroll back up to top of gallery
      grid.scrollIntoView({behavior:'smooth'})
    }
  }

  // Region dropdown (uses country + region text)
  function fillRegions(){
    const current = regionSel.value
    regionSel.innerHTML = '<option value="">All regions</option>'
    const labels = new Set()
    DATA.forEach(d=>{
      const label = d.country || d.region
      if(label) labels.add(label)
    })
    Array.from(labels).sort().forEach(label=>{
      const o=document.createElement('option')
      o.textContent = label
      o.value = label
      regionSel.appendChild(o)
    })
    regionSel.value = current
  }

  // Render Gallery ---------------------------------------------------
  function render(list){
    grid.innerHTML = ''
    const empty = document.getElementById('empty')
    if(!list.length){
      empty.hidden = false
      return
    } else {
      empty.hidden = true
    }
    list.forEach(item=>{
      const card=document.createElement('article')
      card.className='card'
      card.tabIndex=0
      card.setAttribute('role','button')
      card.title='Open details'
      card.innerHTML = `
        <div class="thumbWrap">
          <img class="thumb" src="${item.img}" alt="${item.title}" loading="lazy" />
        </div>
        <div class="meta">
          <div class="title">${item.title}</div>
          <div class="chips">
            <span class="chip">${item.country || item.region}</span>
            <span class="chip">${item.category}</span>
          </div>
        </div>`
      card.addEventListener('click',()=>openModal(item))
      card.addEventListener('keypress',e=>{ if(e.key==='Enter') openModal(item) })
      grid.appendChild(card)
    })
  }

  function openModal(item){
    mTitle.textContent = item.title
    const loc = item.country || item.region
    const macro = item.macro || ''
    mBadges.innerHTML = `
      ${loc ? `<span class="pill">${loc}</span>` : ''}
      ${macro ? `<span class="pill">${macro}</span>` : ''}
      <span class="pill">${item.category}</span>
    `
    mImg.src = item.img
    mImg.alt = item.title
    mNotes.innerHTML = item.notes || ''
    mSources.innerHTML = (item.sources||[]).map(s=>
      `<li>${s.url
        ? `<a href="${s.url}" target="_blank" rel="noopener">${s.label}</a>`
        : s.label}</li>`
    ).join('')
    mTags.innerHTML = (item.tags||[]).map(t=>`<span class="chip">${t}</span>`).join('')
    const ext = (item.img.split('.').pop()||'jpg')
    mFile.href = item.img
    mFile.download = `${item.id||item.title}.${ext}`
    modal.showModal()
    history.replaceState(null,'',`#/morph/${encodeURIComponent(item.id||item.title)}`)
  }

  modal.addEventListener('close',()=>{
    if(location.hash.startsWith('#/morph/')){
      history.replaceState(null,'', lastViewHash)
    }
    route()
  })

  // Filters ----------------------------------------------------------
  function applyFilters(){
    const term = q.value.trim().toLowerCase()
    const regionFilter = regionSel.value
    const catFilter = catSel.value
    const out = DATA.filter(d=>{
      const text = [
        d.title,
        d.country,
        d.region,
        d.macro,
        d.category,
        d.notes || '',
        (d.tags||[]).join(' ')
      ].join(' ').toLowerCase()
      const matchesText = !term || text.includes(term)
      const locLabel = d.country || d.region
      const matchesRegion = !regionFilter || regionFilter === locLabel
      const matchesCategory = !catFilter || catFilter === d.category
      return matchesText && matchesRegion && matchesCategory
    })
    render(out)
  }
  q.addEventListener('input', applyFilters)
  regionSel.addEventListener('change', applyFilters)
  catSel.addEventListener('change', applyFilters)

  // A–Z view ---------------------------------------------------------
  function renderAZ(){
    const byTitle = [...DATA].sort((a,b)=>a.title.localeCompare(b.title))
    let html=''
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('')
    letters.forEach(L=>{
      const group = byTitle.filter(x=> (x.title||'').toUpperCase().startsWith(L))
      if(group.length){
        html += `<h2>${L}</h2><div class="az">` +
          group.map(x=>`<a href="#/morph/${encodeURIComponent(x.id||x.title)}" data-id="${x.id}">${x.title}</a>`).join('') +
          '</div>'
      }
    })
    viewAZ.innerHTML = html || '<div class="empty">No entries yet.</div>'
    viewAZ.querySelectorAll('a').forEach(a=>a.addEventListener('click',e=>{
      e.preventDefault()
      const id=decodeURIComponent(a.getAttribute('href').split('/').pop())
      const it=DATA.find(d=>(d.id||d.title)===id)
      if(it) openModal(it)
    }))
  }

  // Regions view: macro regions -> countries + search ----------------
  function renderRegions(){
    const macroMap = {}
    DATA.forEach(d=>{
      const macro = d.macro || 'Other'
      const country = d.country || d.region || 'Unknown'
      if(!macroMap[macro]) macroMap[macro] = {}
      macroMap[macro][country] = (macroMap[macro][country] || 0) + 1
    })
    const macros = Object.keys(macroMap).sort()
    if(!macros.length){
      viewRegions.innerHTML = '<div class="empty">No regions yet.</div>'
      return
    }
    let html = `
      <div style="margin-bottom:12px">
        <input id="regionSearch" placeholder="Search by country…" />
      </div>
    `
    macros.forEach(macro=>{
      const countries = Object.entries(macroMap[macro]).sort((a,b)=>a[0].localeCompare(b[0]))
      html += `<h2>${macro}</h2><div class="kvs">` +
        countries.map(([country,count]) =>
          `<a href="#/gallery" class="az" data-country="${country}">
             <strong>${country}</strong><br/>
             <span class="muted">${count} entr${count===1?'y':'ies'}</span>
           </a>`
        ).join('') +
        '</div>'
    })
    viewRegions.innerHTML = html

    // Click to filter gallery by country
    viewRegions.querySelectorAll('a[data-country]').forEach(a=>a.addEventListener('click',e=>{
      e.preventDefault()
      const country = a.dataset.country
      regionSel.value = country
      setTab('gallery')
      applyFilters()
    }))

    // Search box to filter countries in-place
    const search = document.getElementById('regionSearch')
    if(search){
      search.addEventListener('input', ()=>{
        const term = search.value.trim().toLowerCase()
        viewRegions.querySelectorAll('a[data-country]').forEach(a=>{
          const name = a.dataset.country.toLowerCase()
          a.style.display = !term || name.includes(term) ? '' : 'none'
        })
      })
    }
  }

  // Router -----------------------------------------------------------
  function route(){
    const h=location.hash||'#/gallery'
    if(h.startsWith('#/morph/')){
      const id=decodeURIComponent(h.split('/').pop())
      const it=DATA.find(d=>(d.id||d.title)===id)
      if(it) openModal(it)
      return
    } else if(h.startsWith('#/a-z')){
      setTab('az')
    } else if(h.startsWith('#/regions')){
      setTab('regions')
    } else if(h.startsWith('#/about')){
      setTab('about')
    } else {
      setTab('gallery')
    }
  }
  window.addEventListener('hashchange', route)

  // Contribute button -> scroll to embedded Tally form ---------------
  const contributeBtn = document.getElementById('contributeBtn')
  if(contributeBtn){
    contributeBtn.addEventListener('click',()=>{
      if(contributeSection){
        contributeSection.scrollIntoView({behavior:'smooth'})
      }
    })
  }

  // Init -------------------------------------------------------------
  function init(){
    fillRegions()
    applyFilters()
    renderAZ()
    renderRegions()
    route()
  }
  init()
  </script>
</body>
</html>
